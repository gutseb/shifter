---
- debug:
    var: hostvars[source_host].services_to_enable

- debug:
    var: hostvars[source_host].profile

- name: Set container version
  set_fact:
    os_major_version: "{{ hostvars[source_host].ansible_distribution_major_version }}"

- name: Set OS name to rhel
  set_fact:
    os_name: "rhel"
  when: "'RedHat' in '{{ hostvars[source_host].ansible_distribution }}'"

- name: Set OS name to centos
  set_fact:
    os_name: "centos"
  when: "'CenOS' in '{{ hostvars[source_host].ansible_distribution }}'"

- name: Set OS name to fedora
  set_fact:
    os_name: "fedora"
  when: "'Fedora' in '{{ hostvars[source_host].ansible_distribution }}'"

- name: Set container name
  set_fact:
    container_name: "{{ 'shifted_from_' + source_host }}"

#- name: Prepend used services
#  set_fact:
#    container_name: "{{ [service_name,container_name | default('')] | join('_') }}"
#  with_items: "{{ hostvars[source_host].services_to_enable }}"
#  loop_control:
#    loop_var: service_name

- name: Combine collected facts to create container name
  set_fact:
    container_name: "{{ os_name + os_major_version + '_' + hostvars[source_host].profile + '_' + container_name }}"

- debug:
    var: container_name

- name: Create directory to hold Dockerfile
  file:
    path: ~/{{ container_name }}
    state: directory
    mode: 0755
